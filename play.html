<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <title></title>

  <!-- Player Styles -->
  <style>
    html,body {
      margin:0; padding:0; height:100%; width:100%; background:#000; overflow:hidden;
    }
    #player-wrapper {
      position:fixed; inset:0; background:#000;
    }
    #player {
      width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      color:#fff; font-family:Arial,sans-serif; font-size:16px; text-align:center;
    }
    #player video {
      object-fit:fill !important;
      width:100% !important;
      height:100% !important;
      background-color:#000;
    }
    .error-message {
      color:#ff4d4d;
      font-size:18px;
      font-weight:bold;
      background:rgba(0,0,0,0.6);
      padding:12px 20px;
      border-radius:6px;
      margin-bottom:15px;
    }
  </style>
</head>

<body>
  <div id="player-wrapper">
    <div id="player">Loading player...</div>
  </div>

  <!-- Clappr Core -->
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <!-- Plugins -->
  <script src="https://cdn.jsdelivr.net/npm/level-selector@0.2.0/dist/level-selector.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@c3voc/clappr-audio-track-selector@0.2.4/dist/audio-track-selector.min.js"></script>

  <script>
    // Get ?id= parameter from URL
    const urlParams = new URLSearchParams(window.location.search);
    const streamUrl = urlParams.get("url");

    if (!streamUrl) {
      document.getElementById("player").innerHTML =
        "<div><p class='error-message'";
    } else {
      // Initialize Clappr Player
      var player = new Clappr.Player({
        source: streamUrl,
        parentId: "#player",
        width: "100%",
        height: "100%",
        autoPlay: true,
        mute: true, // autoplay-friendly for mobile
        loop: false,
        plugins: [LevelSelector, AudioTrackSelector],
        levelSelectorConfig: { title: "Quality" },
        audioTrackSelectorConfig: {
          title: "Audio",
          labelCallback: function(track) {
            return track.lang || track.name || "Unknown";
          },
        },
        mediacontrol: { seekbar: "#e92065", buttons: "#e92065" },
        playback: {
          playInline: true,
          crossOrigin: "anonymous",
          hlsjsConfig: {
            capLevelToPlayerSize: true,
            maxBufferLength: 30,
          },
        },
      });

      // Error handling
      player.on(Clappr.Events.PLAYER_ERROR, function() {
        document.getElementById("player").innerHTML =
          "<div><p class='error-message'>Stream unavailable. Please try again later.</p></div>";
      });
    }
  </script>
</body>
</html>
